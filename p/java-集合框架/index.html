<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Java é›†åˆæ¡†æ¶æ˜¯ Java utils åŒ…ä¸‹çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼ŒåŒ…å«å¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼Œä¾‹å¦‚ Listã€Mapã€Queue ç­‰ï¼Œæœ¬æ–‡ä¸»è¦æ˜¯åˆ†æ Listã€Map çš„æºç å’ŒåŸç†ï¼Œè®°å½•å­¦ä¹ åŸºç¡€æ•°æ®ç»“æ„åŸç†çš„è¿‡ç¨‹"><title>Java é›†åˆæ¡†æ¶</title>
<link rel=canonical href=https://yameizitd.github.io/p/java-%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6/><link rel=stylesheet href=/scss/style.min.6b9dd0f375f20486079a2269e206c76c4f0776ce3c3c5ea70f85d875885ab26e.css><meta property="og:title" content="Java é›†åˆæ¡†æ¶"><meta property="og:description" content="Java é›†åˆæ¡†æ¶æ˜¯ Java utils åŒ…ä¸‹çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼ŒåŒ…å«å¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼Œä¾‹å¦‚ Listã€Mapã€Queue ç­‰ï¼Œæœ¬æ–‡ä¸»è¦æ˜¯åˆ†æ Listã€Map çš„æºç å’ŒåŸç†ï¼Œè®°å½•å­¦ä¹ åŸºç¡€æ•°æ®ç»“æ„åŸç†çš„è¿‡ç¨‹"><meta property="og:url" content="https://yameizitd.github.io/p/java-%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6/"><meta property="og:site_name" content="yameizitd"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="Collection"><meta property="article:tag" content="List"><meta property="article:tag" content="Map"><meta property="article:tag" content="HashMap"><meta property="article:published_time" content="2023-07-18T00:00:00+00:00"><meta property="article:modified_time" content="2023-07-18T00:00:00+00:00"><meta property="og:image" content="https://yameizitd.github.io/p/java-%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6/cover.jpg"><meta name=twitter:title content="Java é›†åˆæ¡†æ¶"><meta name=twitter:description content="Java é›†åˆæ¡†æ¶æ˜¯ Java utils åŒ…ä¸‹çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼ŒåŒ…å«å¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼Œä¾‹å¦‚ Listã€Mapã€Queue ç­‰ï¼Œæœ¬æ–‡ä¸»è¦æ˜¯åˆ†æ Listã€Map çš„æºç å’ŒåŸç†ï¼Œè®°å½•å­¦ä¹ åŸºç¡€æ•°æ®ç»“æ„åŸç†çš„è¿‡ç¨‹"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://yameizitd.github.io/p/java-%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6/cover.jpg"><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu92d9cdee38c9c83afc5e9f9558b7ada1_451689_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸ˜º</span></figure><div class=site-meta><h1 class=site-name><a href=/>yameizitd</a></h1><h2 class=site-description>Goodbye, Adriatic free and debauched life</h2></div></header><ol class=social-menu><li><a href=https://github.com/yameizitd target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=mailto:yameizitd@gmail.com target=_blank title=Email rel=me><!doctype html><svg t="1702518145393" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="2320" width="64" height="64" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M799.219 812.558q-144.552.0-578.207.0-50.876.0-87.216-36.34-37.147-35.532-37.147-86.408.0-25.034.0-62.182.0-37.955.0-87.216.0-12.921.0-32.302t0-44.415q0-50.876.0-127.593.0-50.876 36.34-87.216 36.34-35.532 88.023-35.532 193.005.0 578.207.0 50.876.0 87.216 35.532 37.147 36.34 37.147 87.216.0 118.71.0 355.323.0 50.876-36.34 85.601-36.34 35.532-88.023 35.532zM888.05 336.102q0-36.34-25.842-61.374-26.649-25.842-62.989-25.842-193.005.0-578.207.0-36.34.0-62.989 25.842-25.842 25.034-25.842 61.374.0 12.113.0 36.34.0 20.189.0 50.068.0 22.611.0 50.876.0 20.996.0 45.223.0 72.68.0 172.816.0 36.34 25.842 61.374 26.649 25.842 62.989 25.842 193.005.0 578.207.0 36.34.0 62.989-25.842 25.842-25.034 25.842-61.374.0-118.71.0-355.323zM822.638 647.817q5.653-5.653 5.653-12.921t-5.653-12.113q-50.068-50.876-151.012-151.82 37.147-35.532 148.59-142.129 4.845-4.845 4.845-12.113t-4.845-12.113q-4.845-5.653-12.113-5.653-7.268.0-12.921 5.653-95.291 91.253-285.066 272.953-71.872-67.834-288.296-272.953-4.845-5.653-12.113-5.653t-12.921 5.653q-4.845 4.845-4.845 12.113t5.653 12.113q50.068 47.646 150.205 143.744-37.955 37.147-151.82 150.205-5.653 4.845-5.653 12.113.0 7.268 5.653 12.921 8.076 4.845 12.113 4.845 8.883.0 12.921-4.845 50.068-50.876 151.012-151.82 30.687 29.879 124.363 118.71 5.653 4.845 12.921 4.845 6.46.0 12.113-4.845 41.185-39.57 123.555-118.71 37.955 37.955 151.82 151.82 5.653 4.845 12.113 4.845 10.498.0 13.728-4.845z" p-id="2321" fill="#4c4c4c"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><li><a href=/links/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg><span>Links</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#list>List</a><ol><li><a href=#arraylist>ArrayList</a></li><li><a href=#linkedlist>LinkedList</a><ol><li><a href=#å…³äº-linkedlist-çš„ä¸€äº›å…¶å®ƒå°ç‰¹æ€§>å…³äº LinkedList çš„ä¸€äº›å…¶å®ƒå°ç‰¹æ€§</a></li></ol></li></ol></li><li><a href=#set>Set</a><ol><li><a href=#hashset>HashSet</a></li></ol></li><li><a href=#queue>Queue</a><ol><li><a href=#priorityqueue>PriorityQueue</a></li></ol></li></ol><ol><li><a href=#hashmap>HashMap</a><ol><li><a href=#ä»æˆå‘˜å˜é‡å¼€å§‹>ä»æˆå‘˜å˜é‡å¼€å§‹</a></li><li><a href=#æ„é€ å‡½æ•°>æ„é€ å‡½æ•°</a></li><li><a href=#ä»æ·»åŠ å…ƒç´ è¯´èµ·>ä»æ·»åŠ å…ƒç´ è¯´èµ·</a><ol><li><a href=#æ‡’åˆå§‹åŒ–>æ‡’åˆå§‹åŒ–</a></li><li><a href=#è·å–å­˜å‚¨ä½ç½®>è·å–å­˜å‚¨ä½ç½®</a></li><li><a href=#å“ˆå¸Œç¢°æ’>å“ˆå¸Œç¢°æ’</a></li></ol></li><li><a href=#åˆ é™¤å…ƒç´ å’ŒæŸ¥æ‰¾å…ƒç´ >åˆ é™¤å…ƒç´ å’ŒæŸ¥æ‰¾å…ƒç´ </a><ol><li><a href=#åˆ é™¤å…ƒç´ >åˆ é™¤å…ƒç´ </a></li><li><a href=#æŸ¥æ‰¾å…ƒç´ >æŸ¥æ‰¾å…ƒç´ </a></li></ol></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/java-%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6/><img src=/p/java-%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6/cover_hu3d03a01dcc18bc5be0e67db3d8d209a6_292617_800x0_resize_q75_box.jpg srcset="/p/java-%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6/cover_hu3d03a01dcc18bc5be0e67db3d8d209a6_292617_800x0_resize_q75_box.jpg 800w, /p/java-%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6/cover_hu3d03a01dcc18bc5be0e67db3d8d209a6_292617_1600x0_resize_q75_box.jpg 1600w" width=800 height=533 loading=lazy alt="Featured image of post Java é›†åˆæ¡†æ¶"></a></div><div class=article-details><header class=article-category><a href=/categories/note/ style=background-color:#2a9d8f;color:#fff>å­¦ä¹ ç¬”è®°</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/java-%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6/>Java é›†åˆæ¡†æ¶</a></h2><h3 class=article-subtitle>Java é›†åˆæ¡†æ¶æ˜¯ Java utils åŒ…ä¸‹çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼ŒåŒ…å«å¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼Œä¾‹å¦‚ Listã€Mapã€Queue ç­‰ï¼Œæœ¬æ–‡ä¸»è¦æ˜¯åˆ†æ Listã€Map çš„æºç å’ŒåŸç†ï¼Œè®°å½•å­¦ä¹ åŸºç¡€æ•°æ®ç»“æ„åŸç†çš„è¿‡ç¨‹</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Jul 18, 2023</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>11 minute read</time></div></footer></div></header><section class=article-content><p>Java çš„é›†åˆæ¡†æ¶ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šCollection å’Œ Map</p><h1 id=collection>Collection</h1><p>Collection ä¸»è¦æœ‰ä¸‰ä¸ªæ¥å£ï¼šListã€Set å’Œ Queue</p><h2 id=list>List</h2><p>List æ˜¯åˆ—è¡¨ç»“æ„ï¼Œåœ¨ Java ä¸­ä¸»è¦æœ‰ä¸¤ç§å¸¸ç”¨çš„å®ç°ï¼šArrayList å’Œ LinkedList</p><h3 id=arraylist>ArrayList</h3><p>ArrayList æ˜¯åŸºäºåŠ¨æ€æ•°ç»„å®ç°çš„åˆ—è¡¨ç»“æ„ï¼Œç®€å•æ¥è¯´å°±æ˜¯ä½¿ç”¨æ•°ç»„çš„æ¯ä¸ªæ§½ä½å­˜å‚¨èŠ‚ç‚¹ï¼Œä½¿ç”¨ä¸€ä¸ªæ•´å‹æ ‡è¯†å…ƒç´ çš„æ•°é‡ï¼Œæ¯æ¬¡æ’å…¥å…ƒç´ æ—¶æ¯”è¾ƒå…ƒç´ æ•°é‡æ˜¯å¦è¶…è¿‡æ•°ç»„å®¹é‡ï¼Œè¶…è¿‡åˆ™è¿›è¡Œæ‰©å®¹</p><p>å°¾éƒ¨æ’å…¥å…ƒç´ çš„æºç å¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>add</span><span class=p>(</span><span class=n>E</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>modCount</span><span class=o>++</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>add</span><span class=p>(</span><span class=n>e</span><span class=p>,</span><span class=w> </span><span class=n>elementData</span><span class=p>,</span><span class=w> </span><span class=n>size</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>true</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>add</span><span class=p>(</span><span class=n>E</span><span class=w> </span><span class=n>e</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>[]</span><span class=w> </span><span class=n>elementData</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>s</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>s</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>elementData</span><span class=p>.</span><span class=na>length</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>elementData</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>grow</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>elementData</span><span class=o>[</span><span class=n>s</span><span class=o>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>e</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œå½“å…ƒç´ æ•°é‡ç­‰äºæ•°ç»„å®¹é‡æ—¶ï¼Œå°±ä¼šè¿›è¡Œæ‰©å®¹æ“ä½œï¼Œæ‰©å®¹æºç å¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span><span class=w> </span><span class=n>Object</span><span class=o>[]</span><span class=w> </span><span class=nf>grow</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>grow</span><span class=p>(</span><span class=n>size</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>private</span><span class=w> </span><span class=n>Object</span><span class=o>[]</span><span class=w> </span><span class=nf>grow</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>minCapacity</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>oldCapacity</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>elementData</span><span class=p>.</span><span class=na>length</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>oldCapacity</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>0</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>elementData</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>DEFAULTCAPACITY_EMPTY_ELEMENTDATA</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>newCapacity</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ArraysSupport</span><span class=p>.</span><span class=na>newLength</span><span class=p>(</span><span class=n>oldCapacity</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>minCapacity</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>oldCapacity</span><span class=p>,</span><span class=w> </span><span class=cm>/* minimum growth */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>oldCapacity</span><span class=w> </span><span class=o>&gt;&gt;</span><span class=w> </span><span class=n>1</span><span class=w>           </span><span class=cm>/* preferred growth */</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>elementData</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Arrays</span><span class=p>.</span><span class=na>copyOf</span><span class=p>(</span><span class=n>elementData</span><span class=p>,</span><span class=w> </span><span class=n>newCapacity</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>elementData</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Object</span><span class=o>[</span><span class=n>Math</span><span class=p>.</span><span class=na>max</span><span class=p>(</span><span class=n>DEFAULT_CAPACITY</span><span class=p>,</span><span class=w> </span><span class=n>minCapacity</span><span class=p>)</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// ArraysSupport.java</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=nf>newLength</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>oldLength</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>minGrowth</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>prefGrowth</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// preconditions not checked because of inlining</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// assert oldLength &gt;= 0    // assert minGrowth &gt; 0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>prefLength</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>oldLength</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>Math</span><span class=p>.</span><span class=na>max</span><span class=p>(</span><span class=n>minGrowth</span><span class=p>,</span><span class=w> </span><span class=n>prefGrowth</span><span class=p>);</span><span class=w> </span><span class=c1>// might overflow</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>0</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>prefLength</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>prefLength</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=n>SOFT_MAX_ARRAY_LENGTH</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>prefLength</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// put code cold in a separate method</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>hugeLength</span><span class=p>(</span><span class=n>oldLength</span><span class=p>,</span><span class=w> </span><span class=n>minGrowth</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>ç®€å•æ¥è¯´ï¼Œå°±æ˜¯åŸå§‹æ•°ç»„å®¹é‡å¤§å° + åŸæ•°ç»„å®¹é‡å¤§å°å³ç§»ä¸€ä½ï¼ˆå³ 0.5 å€çš„åŸæ•°ç»„å®¹é‡å¤§å°ï¼‰ï¼Œå³åŸæ•°ç»„å®¹é‡å¤§å°çš„ 1.5 å€
åœ¨æ‰©å®¹æœŸé—´ï¼Œç›´æ¥ä½¿ç”¨ <code>Arrays.copyOf</code> æ–¹æ³•ï¼Œè¿™æœ€ç»ˆæ˜¯è°ƒç”¨ä¸€ä¸ª <code>JNI</code> æ–¹æ³•ï¼Œæºç å¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Arrays.java</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span><span class=n>U</span><span class=o>&gt;</span><span class=w> </span><span class=n>T</span><span class=o>[]</span><span class=w> </span><span class=nf>copyOf</span><span class=p>(</span><span class=n>U</span><span class=o>[]</span><span class=w> </span><span class=n>original</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>newLength</span><span class=p>,</span><span class=w> </span><span class=n>Class</span><span class=o>&lt;?</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>T</span><span class=o>[]&gt;</span><span class=w> </span><span class=n>newType</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@SuppressWarnings</span><span class=p>(</span><span class=s>&#34;unchecked&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>T</span><span class=o>[]</span><span class=w> </span><span class=n>copy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>((</span><span class=n>Object</span><span class=p>)</span><span class=n>newType</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=p>(</span><span class=n>Object</span><span class=p>)</span><span class=n>Object</span><span class=o>[]</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>?</span><span class=w> </span><span class=p>(</span><span class=n>T</span><span class=o>[]</span><span class=p>)</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Object</span><span class=o>[</span><span class=n>newLength</span><span class=o>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>:</span><span class=w> </span><span class=p>(</span><span class=n>T</span><span class=o>[]</span><span class=p>)</span><span class=w> </span><span class=n>Array</span><span class=p>.</span><span class=na>newInstance</span><span class=p>(</span><span class=n>newType</span><span class=p>.</span><span class=na>getComponentType</span><span class=p>(),</span><span class=w> </span><span class=n>newLength</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>System</span><span class=p>.</span><span class=na>arraycopy</span><span class=p>(</span><span class=n>original</span><span class=p>,</span><span class=w> </span><span class=n>0</span><span class=p>,</span><span class=w> </span><span class=n>copy</span><span class=p>,</span><span class=w> </span><span class=n>0</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                     </span><span class=n>Math</span><span class=p>.</span><span class=na>min</span><span class=p>(</span><span class=n>original</span><span class=p>.</span><span class=na>length</span><span class=p>,</span><span class=w> </span><span class=n>newLength</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>copy</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// System.java</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>native</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>arraycopy</span><span class=p>(</span><span class=n>Object</span><span class=w> </span><span class=n>src</span><span class=p>,</span><span class=w>  </span><span class=kt>int</span><span class=w>  </span><span class=n>srcPos</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                    </span><span class=n>Object</span><span class=w> </span><span class=n>dest</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>destPos</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                    </span><span class=kt>int</span><span class=w> </span><span class=n>length</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>æŒ‰ç´¢å¼•ä½ç½®æ’å…¥å…ƒç´ çš„ä»£ç æ˜¯ç±»ä¼¼çš„ï¼Œåªæ˜¯éœ€è¦ä½¿ç”¨ <code>Arrays.copyOf</code> å°†ç´¢å¼•ä½ç½®åŠä»¥åçš„å…ƒç´ å…¨éƒ¨å¾€åç§»åŠ¨ä¸€ä¸ªæ§½ä½ï¼Œä»¥ç©ºå‡ºç´¢å¼•ä½ç½®çš„æ§½ä½ä¾›æ–°å…ƒç´ æ’å…¥ã€‚è¿™ä¹Ÿæ˜¯ ArrayList éå°¾éƒ¨æ’å…¥æ•ˆç‡ä½ä¸‹çš„åŸå› ï¼Œå­˜åœ¨å¤§é‡çš„æ•°æ®æ‹·è´</p><p>åˆ é™¤å…ƒç´ æ—¶ï¼Œå°±æ˜¯ä»å¤´å¼€å§‹éå†ï¼Œç›´åˆ°æ‰¾åˆ°å¯¹åº”çš„å…ƒç´ ï¼Œç„¶åè®°å½•ä¸‹æ ‡ï¼Œæœ€åä½¿ç”¨ <code>Arrays.copyOf</code> å°†ç´¢å¼•ä½ç½®åé¢çš„å…ƒç´ å…¨éƒ¨å‰ç§»ä¸€ä¸ªæ§½ä½ï¼Œè¿™æ ·ç´¢å¼•ä½ç½®çš„å…ƒç´ å°±ç­‰äºè¢«åˆ é™¤äº†ã€‚æºç å¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>remove</span><span class=p>(</span><span class=n>Object</span><span class=w> </span><span class=n>o</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>final</span><span class=w> </span><span class=n>Object</span><span class=o>[]</span><span class=w> </span><span class=n>es</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>elementData</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>final</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>size</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>found</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>o</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>for</span><span class=w> </span><span class=p>(;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>size</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>es</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>break</span><span class=w> </span><span class=n>found</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>for</span><span class=w> </span><span class=p>(;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>size</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>o</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>es</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>break</span><span class=w> </span><span class=n>found</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>false</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>fastRemove</span><span class=p>(</span><span class=n>es</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>true</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>fastRemove</span><span class=p>(</span><span class=n>Object</span><span class=o>[]</span><span class=w> </span><span class=n>es</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>modCount</span><span class=o>++</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>final</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>newSize</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>((</span><span class=n>newSize</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>size</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>1</span><span class=p>)</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>i</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>arraycopy</span><span class=p>(</span><span class=n>es</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>1</span><span class=p>,</span><span class=w> </span><span class=n>es</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>,</span><span class=w> </span><span class=n>newSize</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>i</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>es</span><span class=o>[</span><span class=n>size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>newSize</span><span class=o>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>æ‰€ä»¥ï¼ŒArrayList çš„åˆ é™¤æ“ä½œä¹Ÿæ˜¯æ¯”è¾ƒä½æ•ˆçš„ï¼Œå¯èƒ½å­˜åœ¨å¤§é‡æ•°æ®çš„å¤åˆ¶æ‹·è´</p><p>ArrayList æ ¹æ®ç´¢å¼•ä½ç½®çš„æŸ¥è¯¢æ“ä½œååˆ†é«˜æ•ˆï¼Œå› ä¸ºä½¿ç”¨çš„æ•°ç»„ç»“æ„ï¼Œé€šè¿‡ç´¢å¼•ä½ç½®æŸ¥æ‰¾å…ƒç´ æ—¶ï¼Œç›´æ¥è¿”å›å¯¹åº”ä½ç½®çš„å…ƒç´ å³å¯</p><p>å…¶ä»–ä¸€äº›å¸¸ç”¨çš„æ“ä½œæ–¹æ³•ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œå¤§å¤šä½¿ç”¨ <code>Arrays.copyOf</code> æ–¹æ³•å®Œæˆ</p><p>ç»¼ä¸Šï¼ŒArrayList çš„å°¾æ’å’ŒæŒ‰ç´¢å¼•æŸ¥æ‰¾æ•ˆç‡å¾ˆé«˜ï¼Œä½†æ˜¯åˆ é™¤å…ƒç´ å’Œéå°¾æ’æ•ˆç‡è¾ƒä½</p><h3 id=linkedlist>LinkedList</h3><p>LinkedList æ˜¯åŸºäºåŒå‘é“¾è¡¨å®ç°çš„ï¼Œå…¶èŠ‚ç‚¹çš„æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>class</span> <span class=nc>Node</span><span class=o>&lt;</span><span class=n>E</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>E</span><span class=w> </span><span class=n>item</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Node</span><span class=o>&lt;</span><span class=n>E</span><span class=o>&gt;</span><span class=w> </span><span class=n>next</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Node</span><span class=o>&lt;</span><span class=n>E</span><span class=o>&gt;</span><span class=w> </span><span class=n>prev</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Node</span><span class=p>(</span><span class=n>Node</span><span class=o>&lt;</span><span class=n>E</span><span class=o>&gt;</span><span class=w> </span><span class=n>prev</span><span class=p>,</span><span class=w> </span><span class=n>E</span><span class=w> </span><span class=n>element</span><span class=p>,</span><span class=w> </span><span class=n>Node</span><span class=o>&lt;</span><span class=n>E</span><span class=o>&gt;</span><span class=w> </span><span class=n>next</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>item</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>element</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>next</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>next</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>prev</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>prev</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œæœ‰ä¸¤ä¸ªç±»ä¼¼æŒ‡é’ˆä½œç”¨çš„å¼•ç”¨ï¼Œåˆ†åˆ«æŒ‡å‘å‰ä¸€ä¸ªèŠ‚ç‚¹å’Œåä¸€ä¸ªèŠ‚ç‚¹</p><p>å°¾æ’å…ƒç´ æ—¶ï¼Œåªéœ€è¦å°†å…ƒç´ é“¾æ¥åˆ°é“¾è¡¨çš„å°¾éƒ¨å³å¯ï¼Œæºç å¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>add</span><span class=p>(</span><span class=n>E</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>linkLast</span><span class=p>(</span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>true</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kt>void</span><span class=w> </span><span class=nf>linkLast</span><span class=p>(</span><span class=n>E</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>final</span><span class=w> </span><span class=n>Node</span><span class=o>&lt;</span><span class=n>E</span><span class=o>&gt;</span><span class=w> </span><span class=n>l</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>last</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>final</span><span class=w> </span><span class=n>Node</span><span class=o>&lt;</span><span class=n>E</span><span class=o>&gt;</span><span class=w> </span><span class=n>newNode</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Node</span><span class=o>&lt;&gt;</span><span class=p>(</span><span class=n>l</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>last</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>newNode</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>l</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>first</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>newNode</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>else</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	    </span><span class=n>l</span><span class=p>.</span><span class=na>next</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>newNode</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>size</span><span class=o>++</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>modCount</span><span class=o>++</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ LinkedList ä¸­ï¼Œæœ‰ä¸€ä¸ª last å±æ€§ï¼Œå®ƒæŒ‡å‘é“¾è¡¨çš„å°¾éƒ¨èŠ‚ç‚¹ï¼Œåœ¨å°¾æ’æ—¶ï¼Œé¦–å…ˆæ ¹æ®å…ƒç´ æ„å»ºæ–°èŠ‚ç‚¹ï¼ˆæ–°èŠ‚ç‚¹çš„å‰é©±æŒ‡é’ˆæŒ‡å‘ä¹‹å‰ lastï¼‰ï¼Œç„¶åè®© last é‡æ–°æŒ‡å‘æ–°èŠ‚ç‚¹ï¼ˆå³é‡æ–°æŒ‡å‘å°¾éƒ¨èŠ‚ç‚¹ï¼Œå› ä¸ºæ–°èŠ‚ç‚¹æˆä¸ºäº†æ–°çš„å°¾éƒ¨èŠ‚ç‚¹ï¼‰ï¼Œæœ€åå†è®©æ–°èŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹çš„åé©±æŒ‡é’ˆæŒ‡å‘æ–°èŠ‚ç‚¹å³å®Œæˆäº†å°¾æ’æ“ä½œã€‚æµç¨‹å¤§è‡´å¦‚ä¸‹ï¼š
<img src=/p/java-%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6/Collection-1.drawio.svg loading=lazy></p><p>æŒ‰ç´¢å¼•ä½ç½®æ’å…¥å…ƒç´ çš„é€»è¾‘ä¸å¤´éƒ¨ç±»ä¼¼ï¼Œç¨å¤æ‚ä¸€æ­¥ï¼Œå°±æ˜¯ä¸ªç®€å•çš„åŒå‘é“¾è¡¨ä¸­é—´æ·»åŠ èŠ‚ç‚¹çš„æ“ä½œï¼Œæºç å¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>add</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>index</span><span class=p>,</span><span class=w> </span><span class=n>E</span><span class=w> </span><span class=n>element</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>checkPositionIndex</span><span class=p>(</span><span class=n>index</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>index</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>size</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>linkLast</span><span class=p>(</span><span class=n>element</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>else</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	    </span><span class=n>linkBefore</span><span class=p>(</span><span class=n>element</span><span class=p>,</span><span class=w> </span><span class=n>node</span><span class=p>(</span><span class=n>index</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>æ³¨æ„è¿™é‡Œçš„ <code>node</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨æŒ‰ç´¢å¼•ä½ç½®æŸ¥æ‰¾å…ƒç´ æ—¶ä¹Ÿä¼šç”¨åˆ°ï¼Œè¿™æ˜¯ä¸ªå¾ˆæœ‰æ„æ€çš„æ–¹æ³•ï¼Œæºç å¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Node</span><span class=o>&lt;</span><span class=n>E</span><span class=o>&gt;</span><span class=w> </span><span class=nf>node</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>index</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// assert isElementIndex(index);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>index</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=p>(</span><span class=n>size</span><span class=w> </span><span class=o>&gt;&gt;</span><span class=w> </span><span class=n>1</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Node</span><span class=o>&lt;</span><span class=n>E</span><span class=o>&gt;</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>first</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>index</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=na>next</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>x</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Node</span><span class=o>&lt;</span><span class=n>E</span><span class=o>&gt;</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>last</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>size</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>1</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>index</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>--</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=na>prev</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>x</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œ<strong>å…ˆå°†å½“å‰é“¾è¡¨çš„é•¿åº¦å³ç§»ä¸€ä½ï¼ˆå³é™¤ä»¥ 2 ï¼‰ï¼Œç„¶åæ‹¿ç´¢å¼•ä½ç½®å’Œé•¿åº¦çš„ä¸€åŠä½œæ¯”è¾ƒï¼Œå°äºåˆ™ä»é“¾è¡¨å¤´éƒ¨å¾€åæ‰¾ï¼Œå¤§äºå°±ä»é“¾è¡¨å°¾éƒ¨å¾€å‰æ‰¾ï¼Œè¿™ç®—æ˜¯ä¸€ä¸ªå°å°çš„äºŒåˆ†æŸ¥æ‰¾ä¼˜åŒ–</strong>
æ‰¾åˆ°è¦æ’å…¥ä½ç½®çš„å…ƒç´ åï¼Œå°±æ˜¯æ’å…¥æ“ä½œäº†ï¼Œä¸»è¦çœ‹ <code>linkBefore</code> æ–¹æ³•ï¼Œæºç å¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kt>void</span><span class=w> </span><span class=nf>linkBefore</span><span class=p>(</span><span class=n>E</span><span class=w> </span><span class=n>e</span><span class=p>,</span><span class=w> </span><span class=n>Node</span><span class=o>&lt;</span><span class=n>E</span><span class=o>&gt;</span><span class=w> </span><span class=n>succ</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// assert succ != null;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>final</span><span class=w> </span><span class=n>Node</span><span class=o>&lt;</span><span class=n>E</span><span class=o>&gt;</span><span class=w> </span><span class=n>pred</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>succ</span><span class=p>.</span><span class=na>prev</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>final</span><span class=w> </span><span class=n>Node</span><span class=o>&lt;</span><span class=n>E</span><span class=o>&gt;</span><span class=w> </span><span class=n>newNode</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Node</span><span class=o>&lt;&gt;</span><span class=p>(</span><span class=n>pred</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>,</span><span class=w> </span><span class=n>succ</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>succ</span><span class=p>.</span><span class=na>prev</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>newNode</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>pred</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>first</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>newNode</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>else</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	    </span><span class=n>pred</span><span class=p>.</span><span class=na>next</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>newNode</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>size</span><span class=o>++</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>modCount</span><span class=o>++</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>ä¸€ä¸ªæ ‡å‡†çš„åŒå‘é“¾è¡¨ä¸­é—´æ’å…¥æ–¹æ³•ï¼Œé¦–å…ˆæ„å»ºæ–°èŠ‚ç‚¹ï¼Œæ–°èŠ‚ç‚¹çš„å‰é©±æŒ‡é’ˆæŒ‡å‘ç´¢å¼•èŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåé©±æŒ‡é’ˆæŒ‡å‘ç´¢å¼•èŠ‚ç‚¹ï¼Œå†å°†ç´¢å¼•èŠ‚ç‚¹çš„å‰é©±æŒ‡é’ˆæŒ‡å‘æ–°èŠ‚ç‚¹ï¼Œæœ€åè®©<strong>ä¹‹å‰</strong>é‚£ä¸ªç´¢å¼•èŠ‚ç‚¹çš„å‰èŠ‚ç‚¹çš„åé©±æŒ‡é’ˆæŒ‡å‘æ–°èŠ‚ç‚¹ï¼Œæ’å…¥å®Œæ¯•ã€‚æµç¨‹å¦‚ä¸‹ï¼š
<img src=/p/java-%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6/Collection-2.drawio.svg loading=lazy></p><p>æŒ‰ç´¢å¼•ä½ç½®æŸ¥æ‰¾å…ƒç´ ä¸»è¦å°±æ˜¯åˆ©ç”¨ä¹‹å‰æ‰€è¯´çš„ <code>node</code> æ–¹æ³•ï¼Œä¸å†èµ˜è¿°</p><p>ç»¼ä¸Šï¼ŒåŸºäºåŒé“¾è¡¨å®ç°çš„ LinkedList ï¼Œå…¶å°¾æ’å’ŒæŒ‰ç´¢å¼•ä½ç½®æ’å…¥åˆ é™¤æ˜¯ç›¸å¯¹é«˜æ•ˆçš„ï¼Œä½†æ˜¯æŒ‰ç´¢å¼•ä½ç½®çš„æŸ¥æ‰¾æ•ˆç‡è¾ƒä½ï¼Œå› ä¸ºéœ€è¦éå†é“¾è¡¨æ¥è·å–å…ƒç´ ï¼ˆå…¶å®æŒ‰ç´¢å¼•ä½ç½®å¢åˆ ä¹Ÿæ˜¯éœ€è¦å…ˆæ‰¾åˆ°å¯¹åº”ä½ç½®çš„èŠ‚ç‚¹ï¼Œä½†æ˜¯å¢åˆ ç›¸å¯¹ ArrayList æ¥è¯´ï¼Œä¸éœ€è¦ç§»åŠ¨å¤§é‡çš„å…ƒç´ ï¼Œåªè¦ç®€å•çš„ä¿®æ”¹å‡ ä¸ªå¼•ç”¨çš„æŒ‡å‘å³å¯ï¼‰</p><h4 id=å…³äº-linkedlist-çš„ä¸€äº›å…¶å®ƒå°ç‰¹æ€§>å…³äº LinkedList çš„ä¸€äº›å…¶å®ƒå°ç‰¹æ€§</h4><p>è§‚å¯Ÿ LinkedList çš„ç±»å£°æ˜å¯ä»¥å‘ç°ï¼Œå…¶è¿˜å®ç°äº† Deque æ¥å£ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>LinkedList</span><span class=o>&lt;</span><span class=n>E</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>extends</span><span class=w> </span><span class=n>AbstractSequentialList</span><span class=o>&lt;</span><span class=n>E</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>implements</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>E</span><span class=o>&gt;</span><span class=p>,</span><span class=w> </span><span class=n>Deque</span><span class=o>&lt;</span><span class=n>E</span><span class=o>&gt;</span><span class=p>,</span><span class=w> </span><span class=n>Cloneable</span><span class=p>,</span><span class=w> </span><span class=n>java</span><span class=p>.</span><span class=na>io</span><span class=p>.</span><span class=na>Serializable</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>{</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Deque æ˜¯ java ä¸­çš„åŒç«¯é˜Ÿåˆ—æ¥å£ï¼Œä¹Ÿå°±æ˜¯è¯´ LinkedList è¿˜å¯ä»¥å½“ä½œé˜Ÿåˆ—æ¥ä½¿ç”¨ï¼Œä»å…¶åŒå‘é“¾è¡¨çš„åŸºå±‚æ¥çœ‹ï¼Œç¡®å®ä¹Ÿæ˜¯å¯ä»¥ä½œä¸ºåŒç«¯é˜Ÿåˆ—çš„å®ç°</p><h2 id=set>Set</h2><p>Set ä¸­æœ€å¸¸ç”¨çš„æ˜¯ HashSet</p><h3 id=hashset>HashSet</h3><p>HashSet æ˜¯åŸºäº HashMap å®ç°çš„ï¼Œå…¶å®é™…æ˜¯ä½¿ç”¨ HashMap çš„ key å­˜å‚¨å…ƒç´ ï¼Œè€Œ HashMap çš„ key æ­£å¥½å¯ä»¥ä¿è¯å”¯ä¸€æ€§ï¼Œå¯ä»¥å‚è§ HashMap çš„å…·ä½“å®ç°ï¼Œä¸å†èµ˜è¿°</p><h2 id=queue>Queue</h2><p>Queue æ˜¯ java ä¸­çš„é˜Ÿåˆ—æ¥å£ï¼Œé˜Ÿåˆ—æ˜¯ä¸€ç§å…ˆè¿›å…ˆå‡ºçš„ç»“æ„ï¼ŒQueue è¿˜æœ‰ä¸ªå­æ¥å£ï¼Œå°±æ˜¯æˆ‘ä»¬ä¹‹å‰è¯´çš„ Deque ï¼ŒDeque æ˜¯åŒç«¯é˜Ÿåˆ—
Queue æœ‰ä¸€ä¸ªå¾ˆç»å…¸çš„å®ç°æ˜¯ PriorityQueue</p><h3 id=priorityqueue>PriorityQueue</h3><p>PriorityQueue æ˜¯ä¸€ä¸ªä¼˜å…ˆé˜Ÿåˆ—ï¼Œæ”¾å…¥å…¶ä¸­çš„å…ƒç´ ä¼šæŒ‰ç…§é¡ºåºæ‘†æ”¾å¥½ï¼Œé˜Ÿå¤´æ˜¯æœ€å°çš„å…ƒç´ ï¼Œè¿™é‡Œå¯¹å…¶åŸç†ä¸åšé˜è¿°ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥ç¿»çœ‹æºç </p><p>PriorityQueue æœ‰ä¸€ä¸ªç»å…¸çš„åº”ç”¨åœºæ™¯ï¼š<strong>TopK</strong>
å‡è®¾æœ‰ä¸€ä¸ªæ— åº int æ•°ç»„ array ï¼Œç°åœ¨è¦æ±‚è·å–å…¶å‰ k ä¸ªæœ€å¤§çš„å…ƒç´ ï¼Ÿ
ä½¿ç”¨ PriorityQueue è§£å†³è¿™ä¸ªé—®é¢˜å°†ä¼šéå¸¸ç®€å•ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kt>int</span><span class=o>[]</span><span class=w> </span><span class=nf>getTopK</span><span class=p>(</span><span class=kt>int</span><span class=o>[]</span><span class=w> </span><span class=n>array</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>k</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>PriorityQueue</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span><span class=w> </span><span class=n>priorityQueue</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>PriorityQueue</span><span class=o>&lt;&gt;</span><span class=p>(</span><span class=n>k</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>array</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>priorityQueue</span><span class=p>.</span><span class=na>size</span><span class=p>()</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>k</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>priorityQueue</span><span class=p>.</span><span class=na>offer</span><span class=p>(</span><span class=n>i</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>priorityQueue</span><span class=p>.</span><span class=na>peek</span><span class=p>()</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>i</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>priorityQueue</span><span class=p>.</span><span class=na>poll</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>priorityQueue</span><span class=p>.</span><span class=na>offer</span><span class=p>(</span><span class=n>i</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>int</span><span class=o>[]</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=kt>int</span><span class=o>[</span><span class=n>k</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>k</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>result</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>priorityQueue</span><span class=p>.</span><span class=na>poll</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>result</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>PriorityQueue é»˜è®¤æ˜¯è‡ªç„¶é¡ºåºæ’åºï¼Œå¦‚æœè¦é€‰æ‹©æœ€å¤§çš„ k ä¸ªæ•°ï¼Œå¯ä»¥æ„é€ å°é¡¶å †ï¼Œæ¯æ¬¡å–æ•°ç»„ä¸­å‰©ä½™æ•°ä¸å †é¡¶çš„å…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœæ–°æ•°æ¯”å †é¡¶å…ƒç´ å¤§ï¼Œåˆ™åˆ é™¤å †é¡¶å…ƒç´ ï¼Œå¹¶æ·»åŠ è¿™ä¸ªæ–°æ•°åˆ°å †ä¸­</p><h1 id=map>Map</h1><p>Collection å’Œ Map ç»„æˆäº† java çš„é›†åˆæ¡†æ¶ä½“ç³»ï¼ŒMap å¯ä»¥è¯´æ˜¯ java ä¸­æœ€é«˜é¢‘ä½¿ç”¨çš„ä¸€ç§æ•°æ®ç»“æ„äº†ï¼Œä¸‹é¢å°±æ¥ä¸€èµ·çœ‹çœ‹ Map çš„ç¥å¥‡ä¹‹å¤„</p><h2 id=hashmap>HashMap</h2><p>HashMap æ˜¯ java ä¸­å“ˆå¸Œè¡¨çš„å®ç°ï¼Œä¹Ÿç®—æ˜¯æœ€å¸¸ç”¨çš„ Map å®ç°äº†ï¼Œç”±äº HashMap çš„å®ç°è¿˜ç®—å¤æ‚ï¼Œæ‰€ä»¥åˆ†å¤šä¸ªå­æ ‡é¢˜è¿›è¡Œè§£æï¼ˆ HashMap çš„å®ç°æœ‰å¾ˆå¤šç²¾å¦™ä¹‹å¤„ï¼Œå…¶æºç æ˜¯å€¼å¾—é˜…è¯»å’Œæ¨æ•²çš„ï¼Œä½†æ˜¯åº”è¯•èˆ¬çš„è®°å¿†å’Œæœºæ¢°å¼çš„é¢è¯•æé—®ï¼Œç®—äº†ä¸æä¹Ÿç½¢ - -ï¼‰</p><h3 id=ä»æˆå‘˜å˜é‡å¼€å§‹>ä»æˆå‘˜å˜é‡å¼€å§‹</h3><p>å…ˆä»ç±»å®šä¹‰çš„ä¸€äº›æˆå‘˜å˜é‡å¼€å§‹å§ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>DEFAULT_INITIAL_CAPACITY</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>1</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>4</span><span class=p>;</span><span class=w> </span><span class=c1>// aka 16</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>MAXIMUM_CAPACITY</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>1</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>30</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>float</span><span class=w> </span><span class=n>DEFAULT_LOAD_FACTOR</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>.</span><span class=na>75f</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>TREEIFY_THRESHOLD</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>8</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>UNTREEIFY_THRESHOLD</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>6</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>MIN_TREEIFY_CAPACITY</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>64</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><code>DEFAULT_INITIAL_CAPACITY</code> æ˜¯ 1 å·¦ç§» 4 ä½å…¶å®å°±æ˜¯ 16 ï¼Œæ˜¯ HashMap é»˜è®¤çš„åˆå§‹å®¹é‡</p><p><code>MAXIMUM_CAPACITY</code> æ˜¯ HashMap çš„æœ€å¤§å®¹é‡</p><p><code>DEFAULT_LOAD_FACTOR</code> ä¸º 0.75 ï¼Œæ˜¯ HashMap çš„è£…è½½å› å­ï¼Œå¯ä»¥ç†è§£ä¸º HashMap åˆå§‹å®¹é‡ä¸º 16 ï¼Œé‚£ä¹ˆ 16 * 0.75 = 12 ï¼Œä¹Ÿå°±æ˜¯å½“æ’å…¥ç¬¬ 13 ä¸ªå…ƒç´ æ—¶ï¼ŒHashMap å°±ä¼šå…ˆè¿›è¡Œ<strong>æ‰©å®¹</strong>æ“ä½œ</p><p><code>TREEIFY_THRESHOLD</code> æ˜¯æ ‘åŒ–çš„é˜ˆå€¼ï¼ŒHashMap æ˜¯ç”±æ•°ç»„ã€é“¾è¡¨ã€çº¢é»‘æ ‘æ„æˆçš„ï¼ˆ HashMap ä½œä¸ºé”®å€¼å­˜å‚¨ï¼Œå®é™…ä¸Šæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ ¹æ®å“ˆå¸Œç®—æ³•å¯¹ key è¿›è¡Œè®¡ç®—å¾—åˆ°åº”è¯¥å­˜æ”¾çš„æ•°ç»„çš„ç´¢å¼•ä½ç½®ï¼Œè¿™å¿…ç„¶å¯¼è‡´<strong>å“ˆå¸Œå†²çª</strong>ï¼Œå³æ•°ç»„çš„ä¸€ä¸ªä½ç½®å°†å­˜æ”¾å¤šä¸ªå…ƒç´ ï¼Œè¿™äº›å…ƒç´ å°†ä»¥é“¾è¡¨/çº¢é»‘æ ‘çš„å½¢å¼æ”¾å…¥æ•°ç»„çš„æŸä¸ªä½ç½®ä¸Šï¼Œå…¶å®åªè¦å°†å¤´èŠ‚ç‚¹/æ ¹èŠ‚ç‚¹æ”¾å…¥æ•°ç»„å¯¹åº”çš„ä½ç½®ä¸Šï¼‰ï¼ŒåŒä¸€ä¸ªæ•°ç»„æ§½ä½å­˜åœ¨å¤šä¸ªå…ƒç´ æ—¶ï¼Œè¿™äº›å…ƒç´ ä¼šå…ˆä»¥é“¾è¡¨çš„å½¢å¼æŒ‚è½½åœ¨æ•°ç»„çš„å¯¹åº”æ§½ä½ä¸Šï¼Œä½†æ˜¯å½“é“¾è¡¨çš„é•¿åº¦å¢é•¿åˆ°ä¸€å®šç¨‹åº¦æ—¶ï¼Œä¹Ÿå°±æ˜¯è¶…è¿‡ 8 æ—¶ï¼Œå°±ä¼šè¿›è¡Œæ ‘åŒ–ï¼Œè½¬æ¢ä¸ºçº¢é»‘æ ‘é‡æ–°æŒ‚è½½åˆ°å¯¹åº”çš„æ•°ç»„æ§½ä½ï¼ˆåé¢ä¼šè¯¦ç»†è®²è§£ï¼Œè¿™é‡Œåªæ˜¯æä¸€ä¸‹è¿™ä¸ªæˆå‘˜å˜é‡çš„å«ä¹‰ï¼‰</p><p><code>UNTREEIFY_THRESHOLD</code> æ˜¯æ ‘é€€åŒ–çš„é˜ˆå€¼ï¼Œä¹Ÿå°±æ˜¯çº¢é»‘æ ‘çš„èŠ‚ç‚¹æ•°å°äº 6 æ—¶é‡æ–°è½¬æ¢ä¸ºé“¾è¡¨</p><p><code>MIN_TREEIFY_CAPACITY</code> æ˜¯æ ‘åŒ–æ—¶å®¹é‡çš„æœ€å°é˜ˆå€¼ï¼Œä¹Ÿå°±æ˜¯è¯´å…‰åŒä¸€ä¸ªæ§½ä½çš„å…ƒç´ è¶…è¿‡ 8 å¹¶ä¸æ˜¯ä¸€å®šä¼šè¿›è¡Œæ ‘åŒ–æ“ä½œçš„ï¼Œå¿…é¡»åŒæ—¶æ»¡è¶³æ•´ä¸ª HashMap çš„å®¹é‡ç­‰äºæˆ–è€…è¶…è¿‡ 64 æ‰è¡Œ</p><h3 id=æ„é€ å‡½æ•°>æ„é€ å‡½æ•°</h3><p>HashMap çš„æ„é€ å‡½æ•°æœ‰ä¸ªå¾ˆæœ‰æ„æ€çš„åœ°æ–¹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=nf>HashMap</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>this</span><span class=p>.</span><span class=na>loadFactor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>DEFAULT_LOAD_FACTOR</span><span class=p>;</span><span class=w> </span><span class=c1>// all other fields defaulted</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=nf>HashMap</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>initialCapacity</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>this</span><span class=p>(</span><span class=n>initialCapacity</span><span class=p>,</span><span class=w> </span><span class=n>DEFAULT_LOAD_FACTOR</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=nf>HashMap</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>initialCapacity</span><span class=p>,</span><span class=w> </span><span class=kt>float</span><span class=w> </span><span class=n>loadFactor</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>initialCapacity</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>IllegalArgumentException</span><span class=p>(</span><span class=s>&#34;Illegal initial capacity: &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                           </span><span class=n>initialCapacity</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>initialCapacity</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>MAXIMUM_CAPACITY</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>initialCapacity</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MAXIMUM_CAPACITY</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>loadFactor</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=n>0</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>Float</span><span class=p>.</span><span class=na>isNaN</span><span class=p>(</span><span class=n>loadFactor</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>IllegalArgumentException</span><span class=p>(</span><span class=s>&#34;Illegal load factor: &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                           </span><span class=n>loadFactor</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>this</span><span class=p>.</span><span class=na>loadFactor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>loadFactor</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>this</span><span class=p>.</span><span class=na>threshold</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>tableSizeFor</span><span class=p>(</span><span class=n>initialCapacity</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>æ³¨æ„è¿™ä¸ªæŒ‡å®šå®¹é‡çš„æ„é€ å‡½æ•° <code>HashMap(int initialCapacity)</code> ï¼Œå…¶ç›´æ¥è°ƒç”¨äº† <code>HashMap(int initialCapacity, float loadFactor)</code> æ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­æœ‰ä¸ªå¥‡æ€ªçš„æ–¹æ³•ï¼š<code>tableSizeFor</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=nf>tableSizeFor</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>cap</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>-</span><span class=n>1</span><span class=w> </span><span class=o>&gt;&gt;&gt;</span><span class=w> </span><span class=n>Integer</span><span class=p>.</span><span class=na>numberOfLeadingZeros</span><span class=p>(</span><span class=n>cap</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span><span class=n>n</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>1</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=p>(</span><span class=n>n</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=n>MAXIMUM_CAPACITY</span><span class=p>)</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>MAXIMUM_CAPACITY</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>å…¶ä¸­ï¼Œ<code>Integer.numberOfLeadingZeros</code> æ–¹æ³•ï¼Œç”¨æ¥è¿”å›æŒ‡å®š intï¼ˆ>= 0ï¼‰ ä»¥äºŒè¿›åˆ¶å½¢å¼å±•ç¤ºæ—¶ï¼Œä»é«˜ä½åˆ°ä½ä½ç¢°åˆ°ç¬¬ä¸€ä¸ª 1 ä¹‹å‰æœ‰å¤šå°‘ä¸ª 0 ï¼Œä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œæ¯”å¦‚ 15 ï¼Œä»¥äºŒè¿›åˆ¶å±•ç¤ºä¸ºï¼š</p><p>0000 0000 0000 0000 0000 0000 0000 1111</p><p>15 - 1 å°±æ˜¯ï¼š</p><p>0000 0000 0000 0000 0000 0000 0000 1110</p><p>é‚£ä¹ˆåœ¨ç¬¬ä¸€ä¸ª 1 ä¹‹å‰ä¸€å…±æœ‰ 28 ä¸ª 0 ï¼Œæ‰€ä»¥è¿”å› 28</p><p>é‚£ä¹ˆå¾—åˆ°è¿™ä¸ªæ•°æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿå¯ä»¥çœ‹åˆ°æ˜¯å°† -1 é€»è¾‘å³ç§»äº†è¿™ä¸ªè¿”å›å€¼çš„ä½æ•°ï¼Œ-1 çš„äºŒè¿›åˆ¶è¡¥ç ä¸ºï¼š</p><p>1111 1111 1111 1111 1111 1111 1111 1111</p><p>ä»¥ 16 ä¸ºä¾‹ï¼Œå³ç§» 28 ä½å°±å˜æˆäº†ï¼š</p><p>0000 0000 0000 0000 0000 0000 0000 1111</p><p>æœ€åå†å°†è¿™ä¸ªæ•° + 1 ï¼Œå¾—åˆ°ï¼š</p><p>0000 0000 0000 0000 0000 0000 0001 0000</p><p>ä¹Ÿå°±æ˜¯ 16 ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªæ–¹æ³•æ˜¯ç”¨æ¥å°†ç”¨æˆ·è®¾ç½®çš„ä¸è§„èŒƒï¼ˆé 2 çš„æ•´æ•°æ¬¡å¹‚ï¼‰çš„åˆå§‹å®¹é‡é‡æ–°è®¾ç½®ä¸º <strong>2 çš„æ•´æ•°æ¬¡å¹‚</strong>çš„ï¼ˆè®¾ç½®çš„å€¼å¤§äºç”¨æˆ·æŒ‡å®šçš„å€¼ï¼Œä¸”æ˜¯æœ€æ¥è¿‘ç”¨æˆ·æŒ‡å®šå€¼çš„ 2 çš„æ•´æ•°æ¬¡å¹‚å€¼ï¼‰ï¼Œè‡³äºä¸ºä»€ä¹ˆä¸€å®šè¦å°†åˆå§‹å®¹é‡è®¾ç½®ä¸º 2 çš„æ•´æ•°æ¬¡å¹‚ï¼Œåé¢ä¼šè¯¦ç»†è¯´åˆ°</p><h3 id=ä»æ·»åŠ å…ƒç´ è¯´èµ·>ä»æ·»åŠ å…ƒç´ è¯´èµ·</h3><p>HashMap æ¯”è¾ƒæ ¸å¿ƒçš„æ–¹æ³•å°±æ˜¯ <code>put</code> æ–¹æ³•äº†ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=n>V</span><span class=w> </span><span class=nf>put</span><span class=p>(</span><span class=n>K</span><span class=w> </span><span class=n>key</span><span class=p>,</span><span class=w> </span><span class=n>V</span><span class=w> </span><span class=n>value</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>putVal</span><span class=p>(</span><span class=n>hash</span><span class=p>(</span><span class=n>key</span><span class=p>),</span><span class=w> </span><span class=n>key</span><span class=p>,</span><span class=w> </span><span class=n>value</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=kc>true</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>åœ¨è°ƒç”¨ <code>putVal</code> æ–¹æ³•ä¹‹å‰ï¼Œå…ˆæ˜¯è°ƒç”¨ <code>hash</code> æ–¹æ³•è·å– key çš„ hash å€¼ï¼Œ<code>hash</code> æ–¹æ³•å¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=nf>hash</span><span class=p>(</span><span class=n>Object</span><span class=w> </span><span class=n>key</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>h</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span><span class=n>key</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>0</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=p>(</span><span class=n>h</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>key</span><span class=p>.</span><span class=na>hashCode</span><span class=p>())</span><span class=w> </span><span class=o>^</span><span class=w> </span><span class=p>(</span><span class=n>h</span><span class=w> </span><span class=o>&gt;&gt;&gt;</span><span class=w> </span><span class=n>16</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>è¿™ä¸ªå°±æ˜¯ HashMap è·å– hash çš„å‡½æ•°ï¼Œé¦–å…ˆå–å¾— key çš„ hash å€¼ï¼Œç„¶åå°†å…¶é€»è¾‘å³ç§» 16 ä½ï¼Œå†å°†ç»“æœå’ŒåŸå“ˆå¸Œå€¼è¿›è¡Œé€»è¾‘ä¸æ“ä½œï¼Œå…¶å®å°±æ˜¯å°† key çš„ hash å€¼çš„é«˜ 16 ä½å‘ä¸‹æ‰©æ•£ï¼Œé™ä½ä¸€äº›ç‰¹å®šæ•°åŠå°å®¹é‡æ—¶ hash ç¢°æ’çš„å¯èƒ½æ€§ï¼Œæœ‰çš„åœ°æ–¹ç§°ä¹‹ä¸ºæŒ¯è¡å‡½æ•°ï¼Œä¸‹é¢æ˜¯ java å®˜æ–¹çš„æ³¨é‡Šè§£é‡Šï¼š</p><blockquote><p>è®¡ç®— <code>key.hashCode()</code> å¹¶<strong>å°†å“ˆå¸Œçš„é«˜ä½æ•°æ‰©å±•åˆ°ä½ä½æ•°</strong>ã€‚å› ä¸ºå“ˆå¸Œè¡¨ä½¿ç”¨äº† 2 çš„å¹‚æ©ç ï¼Œæ‰€ä»¥åœ¨å½“å‰æ©ç ä¹‹ä¸Šåªå˜åŒ–å‡ æ¯”ç‰¹çš„å“ˆå¸Œé›†æ€»æ˜¯ä¼šå‘ç”Ÿå†²çªï¼ˆå…¶ä¸­ä¸€ä¸ªå·²çŸ¥çš„ä¾‹å­æ˜¯åœ¨å°è¡¨æ ¼ä¸­ä¿å­˜è¿ç»­æ•´æ•°çš„ Float é”®é›†ï¼‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åº”ç”¨ä¸€ä¸ªå˜æ¢ï¼Œå°†é«˜æ¯”ç‰¹çš„å½±å“å‘ä¸‹æ‰©æ•£ã€‚æ¯”ç‰¹ä¼ æ’­çš„é€Ÿåº¦ã€æ•ˆç”¨å’Œè´¨é‡ä¹‹é—´å­˜åœ¨æƒè¡¡ã€‚ç”±äºè®¸å¤šå¸¸è§çš„å“ˆå¸Œé›†å·²ç»åˆç†åˆ†å¸ƒï¼ˆå› æ­¤ä¸ä¼šä»æ‰©å±•ä¸­å—ç›Šï¼‰ï¼Œå¹¶ä¸”ç”±äºæˆ‘ä»¬ä½¿ç”¨æ ‘æ¥å¤„ç†ç®±ä¸­çš„å¤§å‹ç¢°æ’é›†ï¼Œå› æ­¤æˆ‘ä»¬åªæ˜¯ä»¥æœ€ç®€å•çš„æ–¹å¼å¯¹ä¸€äº›ç§»ä½çš„ä½è¿›è¡Œå¼‚æˆ–ï¼Œä»¥å‡å°‘ç³»ç»ŸæŸå¤±ï¼Œå¹¶åˆå¹¶æœ€é«˜ä½çš„å½±å“ï¼Œå¦åˆ™ç”±äºå“ˆå¸Œè¡¨è¾¹ç•Œçš„åŸå› ï¼Œè¿™äº›ä½åœ¨ç´¢å¼•è®¡ç®—ä¸­æ°¸è¿œä¸ä¼šä½¿ç”¨</p></blockquote><p>ä¸‹é¢æ˜¯ <code>putVal</code> æ–¹æ³•ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>final</span><span class=w> </span><span class=n>V</span><span class=w> </span><span class=nf>putVal</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>hash</span><span class=p>,</span><span class=w> </span><span class=n>K</span><span class=w> </span><span class=n>key</span><span class=p>,</span><span class=w> </span><span class=n>V</span><span class=w> </span><span class=n>value</span><span class=p>,</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>onlyIfAbsent</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>               </span><span class=kt>boolean</span><span class=w> </span><span class=n>evict</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Node</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span><span class=n>V</span><span class=o>&gt;[]</span><span class=w> </span><span class=n>tab</span><span class=p>;</span><span class=w> </span><span class=n>Node</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span><span class=n>V</span><span class=o>&gt;</span><span class=w> </span><span class=n>p</span><span class=p>;</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>n</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>((</span><span class=n>tab</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>table</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=p>(</span><span class=n>n</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>tab</span><span class=p>.</span><span class=na>length</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>n</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>tab</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>resize</span><span class=p>()).</span><span class=na>length</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>((</span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>tab</span><span class=o>[</span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>n</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>1</span><span class=p>)</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=n>hash</span><span class=o>]</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>tab</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>newNode</span><span class=p>(</span><span class=n>hash</span><span class=p>,</span><span class=w> </span><span class=n>key</span><span class=p>,</span><span class=w> </span><span class=n>value</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Node</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span><span class=n>V</span><span class=o>&gt;</span><span class=w> </span><span class=n>e</span><span class=p>;</span><span class=w> </span><span class=n>K</span><span class=w> </span><span class=n>k</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>p</span><span class=p>.</span><span class=na>hash</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>hash</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>((</span><span class=n>k</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=na>key</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>key</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=p>(</span><span class=n>key</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>key</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>k</span><span class=p>))))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>e</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>p</span><span class=w> </span><span class=k>instanceof</span><span class=w> </span><span class=n>TreeNode</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>e</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>((</span><span class=n>TreeNode</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span><span class=n>V</span><span class=o>&gt;</span><span class=p>)</span><span class=n>p</span><span class=p>).</span><span class=na>putTreeVal</span><span class=p>(</span><span class=k>this</span><span class=p>,</span><span class=w> </span><span class=n>tab</span><span class=p>,</span><span class=w> </span><span class=n>hash</span><span class=p>,</span><span class=w> </span><span class=n>key</span><span class=p>,</span><span class=w> </span><span class=n>value</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>binCount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=o>++</span><span class=n>binCount</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>((</span><span class=n>e</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=na>next</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>p</span><span class=p>.</span><span class=na>next</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>newNode</span><span class=p>(</span><span class=n>hash</span><span class=p>,</span><span class=w> </span><span class=n>key</span><span class=p>,</span><span class=w> </span><span class=n>value</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>binCount</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=n>TREEIFY_THRESHOLD</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>1</span><span class=p>)</span><span class=w> </span><span class=c1>// -1 for 1st</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>treeifyBin</span><span class=p>(</span><span class=n>tab</span><span class=p>,</span><span class=w> </span><span class=n>hash</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>break</span><span class=p>;</span><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=na>hash</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>hash</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>((</span><span class=n>k</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>key</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>key</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=p>(</span><span class=n>key</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>key</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>k</span><span class=p>))))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>break</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>e</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>e</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=c1>// existing mapping for key</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>V</span><span class=w> </span><span class=n>oldValue</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>value</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>onlyIfAbsent</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>oldValue</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>e</span><span class=p>.</span><span class=na>value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>value</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>afterNodeAccess</span><span class=p>(</span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>oldValue</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>++</span><span class=n>modCount</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>++</span><span class=n>size</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>threshold</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>resize</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>afterNodeInsertion</span><span class=p>(</span><span class=n>evict</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=æ‡’åˆå§‹åŒ–>æ‡’åˆå§‹åŒ–</h4><p><code>putVal</code> æ–¹æ³•å¾ˆå¤æ‚ï¼Œæˆ‘ä»¬ä¸€æ®µä¸€æ®µçš„æ¥çœ‹ï¼Œé¦–å…ˆçœ‹çœ‹ç¬¬ä¸€ä¸ª <code>if</code> å­å¥ï¼Œå³å†³å®šæ˜¯å¦éœ€è¦è¿›è¡Œåˆå§‹åŒ–æ“ä½œï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=k>if</span><span class=w> </span><span class=p>((</span><span class=n>tab</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>table</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=p>(</span><span class=n>n</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>tab</span><span class=p>.</span><span class=na>length</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>n</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>tab</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>resize</span><span class=p>()).</span><span class=na>length</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>é¦–å…ˆåˆ¤æ–­ <code>table</code> æ˜¯å¦ä¸ºç©ºï¼Œè¿™ä¸ªåˆ¤æ–­å°±æ˜¯æ£€æŸ¥ HashMap æœ‰æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œé¦–æ¬¡æ’å…¥å…ƒç´ æ—¶ï¼Œ<code>table</code> è‚¯å®šæ˜¯ <code>null</code> çš„ï¼Œæ‰€ä»¥ä¼šè¿›å…¥ <code>resize</code> æ–¹æ³•</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>final</span><span class=w> </span><span class=n>Node</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span><span class=n>V</span><span class=o>&gt;[]</span><span class=w> </span><span class=nf>resize</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>Node</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span><span class=n>V</span><span class=o>&gt;[]</span><span class=w> </span><span class=n>oldTab</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>table</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=kt>int</span><span class=w> </span><span class=n>oldCap</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>oldTab</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>0</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>oldTab</span><span class=p>.</span><span class=na>length</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=kt>int</span><span class=w> </span><span class=n>oldThr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>threshold</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=kt>int</span><span class=w> </span><span class=n>newCap</span><span class=p>,</span><span class=w> </span><span class=n>newThr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// ...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>oldThr</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w> </span><span class=c1>// initial capacity was placed in threshold</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	    </span><span class=n>newCap</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>oldThr</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// ...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>newThr</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	    </span><span class=kt>float</span><span class=w> </span><span class=n>ft</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=kt>float</span><span class=p>)</span><span class=n>newCap</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>loadFactor</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	    </span><span class=n>newThr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>newCap</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>MAXIMUM_CAPACITY</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>ft</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=p>(</span><span class=kt>float</span><span class=p>)</span><span class=n>MAXIMUM_CAPACITY</span><span class=w> </span><span class=o>?</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	              </span><span class=p>(</span><span class=kt>int</span><span class=p>)</span><span class=n>ft</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>Integer</span><span class=p>.</span><span class=na>MAX_VALUE</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>threshold</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>newThr</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nd>@SuppressWarnings</span><span class=p>({</span><span class=s>&#34;rawtypes&#34;</span><span class=p>,</span><span class=s>&#34;unchecked&#34;</span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>Node</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span><span class=n>V</span><span class=o>&gt;[]</span><span class=w> </span><span class=n>newTab</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>Node</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span><span class=n>V</span><span class=o>&gt;[]</span><span class=p>)</span><span class=k>new</span><span class=w> </span><span class=n>Node</span><span class=o>[</span><span class=n>newCap</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>table</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>newTab</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// ...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>return</span><span class=w> </span><span class=n>newTab</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><code>resize</code> æ–¹æ³•å®é™…æ˜¯ç”¨æ¥æ‰©å®¹çš„ï¼Œè¿™é‡Œçœç•¥äº†å¤§é‡çš„å’Œåˆå§‹åŒ–ä¸ç›¸å…³çš„ä»£ç ï¼Œåªå…³æ³¨åˆå§‹åŒ–çš„é€»è¾‘ã€‚å¯ä»¥çœ‹åˆ°å°±æ˜¯è®¾ç½® <code>newCap</code> ä¸º <code>threshold</code> ï¼ˆè¿˜è®°å¾—ä¹‹å‰æ„é€ å‡½æ•°çš„ <code>tableSizeFor</code> æ–¹æ³•å—ï¼Œæœ€åå°±æ˜¯å°† 2 çš„æ•´æ•°æ¬¡å¹‚èµ‹å€¼ç»™äº† <code>threshold</code>ï¼‰ï¼Œç„¶åé‡æ–°è®¡ç®— <code>threshold</code> ä¸º <code>newCap * loadFactor</code> ï¼Œæœ€å <code>new Node[]</code> å¹¶è¿”å›ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>threshold</code> è¿™ä¸ªå˜é‡æ˜¯è¡¨ç¤º<strong>ä¸‹ä¸€æ¬¡æ‰©å®¹çš„é˜ˆå€¼</strong>ï¼Œå¹¶ä¸æ˜¯å®¹é‡ï¼Œåªæ˜¯åœ¨æ„é€ å‡½æ•°ä¸­ä¸´æ—¶å°†å®¹é‡ä¿å­˜åœ¨ <code>threshold</code> ä¸­</p><h4 id=è·å–å­˜å‚¨ä½ç½®>è·å–å­˜å‚¨ä½ç½®</h4><p>ç¡®å®šäº†å®¹é‡ <code>n</code> ä¹‹åï¼Œå°±å¯ä»¥æ¥ç¡®è®¤è¦æ’å…¥å…ƒç´ çš„ä½ç½®äº†ï¼Œä»£ç å°±æ˜¯ä¸Šé¢æåˆ°çš„</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=k>if</span><span class=w> </span><span class=p>((</span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>tab</span><span class=o>[</span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>n</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>1</span><span class=p>)</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=n>hash</span><span class=o>]</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>tab</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>newNode</span><span class=p>(</span><span class=n>hash</span><span class=p>,</span><span class=w> </span><span class=n>key</span><span class=p>,</span><span class=w> </span><span class=n>value</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸»è¦å°±æ˜¯æ ¹æ® <code>(n - 1) & hash</code> æ¥ç¡®å®šå…ƒç´ å­˜å‚¨çš„ä½ç½®çš„ï¼Œè¿™æ˜¯ä¸ªå¾ˆæœ‰æ„æ€çš„æ–¹æ³•ï¼Œä¹Ÿæ˜¯å‰é¢æåˆ°çš„ä¸ºä»€ä¹ˆ HashMap ä¼šå°†ç”¨æˆ·ä¸è§„èŒƒçš„åˆå§‹å®¹é‡è®¾å®šä¸º 2 çš„æ•´æ•°æ¬¡æ–¹å¹‚çš„åŸå› </p><p>ä¸å¦¨æƒ³ä¸€æƒ³ï¼Œ2 çš„æ•´æ•°æ¬¡æ–¹å¹‚å‡å» 1 ä¹‹åç”¨äºŒè¿›åˆ¶è¡¨ç¤ºæ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿæˆ‘ä»¬ä»¥ 16 ä¸ºä¾‹ï¼Œ16 çš„äºŒè¿›åˆ¶å½¢å¼å¦‚ä¸‹ï¼š</p><p>0000 0000 0000 0000 0000 0000 0001 0000</p><p>å‡å» 1 ä»¥åå¦‚ä¸‹ï¼š</p><p>0000 0000 0000 0000 0000 0000 0000 1111</p><p>æ²¡é”™ï¼Œå‡å» 1 ä»¥åï¼Œä¸€å®šæ˜¯ä½ä½å…¨æ˜¯ 1 çš„å½¢å¼ï¼Œæ­¤æ—¶ <code>&</code> ä¸Š hash å€¼ï¼Œæ­£å¥½å¯ä»¥å°† hash å€¼çš„åœ°ä½å…¨éƒ¨ä¿ç•™ä¸‹æ¥ï¼Œä¹Ÿå°±æ˜¯ä½™æ•°ï¼Œä¹Ÿæ˜¯å…ƒç´ åœ¨ HashMap æ•°ç»„ä¸­åº”è¯¥å­˜å‚¨çš„ä½ç½®</p><h4 id=å“ˆå¸Œç¢°æ’>å“ˆå¸Œç¢°æ’</h4><p>æˆ‘ä»¬çŸ¥é“ï¼ŒåŒä¸€ä¸ªå¯¹è±¡çš„ hash å€¼ä¸€å®šæ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯ä¸åŒå¯¹è±¡çš„ hash å€¼å´æ˜¯å¯èƒ½ä¸€æ ·çš„ã€‚å› ä¸ºä»¥ Java ä¸ºä¾‹ï¼Œå­˜å‚¨ hash å€¼çš„ç±»å‹ä¸º int ç±»å‹ï¼Œæ€»å…±å°± 32 ä½ï¼Œè€Œå¯¹è±¡å´å¯èƒ½æ˜¯æ— ç©·æ— å°½çš„ï¼Œæ— å°½çš„å¯¹è±¡è®¡ç®—ä¸ºä¸€ä¸ªæœ‰é™çš„ 32 ä½æ•´æ•°ï¼Œé‡åˆ° hash ä¸€è‡´çš„æƒ…å†µæ˜¯è¿Ÿæ—©çš„äº‹ã€‚hash å€¼ä¸€è‡´ï¼Œé‚£ä¹ˆç»è¿‡å®¹é‡å¯¹ hash å–æ¨¡ä¹‹åï¼Œå¾—åˆ°çš„å­˜å‚¨ä½ç½®ä¹Ÿå°±æ˜¯ä¸€è‡´çš„ï¼Œæ­¤æ—¶å…ƒç´ è¯¥å¦‚ä½•å­˜å‚¨å‘¢ï¼Ÿè¿™å°±æ˜¯å“ˆå¸Œç¢°æ’</p><p>è§£å†³å“ˆå¸Œç¢°æ’çš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œå¸¸ç”¨çš„æ¯”å¦‚ï¼š</p><ul><li>å¼€æ”¾å¯»å€æ³•</li><li>é“¾åœ°å€æ³•</li><li>å†å“ˆå¸Œæ³•</li><li>å»ºç«‹å…¬å…±æº¢å‡ºåŒº</li></ul><p>Java çš„ HashMap é‡‡ç”¨çš„æ–¹æ³•æ˜¯é“¾åœ°å€æ³•ï¼Œä¹Ÿå°±æ˜¯å°†ç¢°æ’çš„å…ƒç´ ä»¥é“¾è¡¨çš„å½¢å¼ä¸²è”èµ·æ¥ï¼Œç„¶åå°†é“¾è¡¨çš„å¤´èŠ‚ç‚¹æ”¾å…¥ hash æ•°ç»„çš„æŒ‡å®šä½ç½®ã€‚ä»£ç å°±æ˜¯ä¹‹å‰æ·»åŠ å…ƒç´ çš„ååŠæ®µï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Node</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span><span class=n>V</span><span class=o>&gt;</span><span class=w> </span><span class=n>e</span><span class=p>;</span><span class=w> </span><span class=n>K</span><span class=w> </span><span class=n>k</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>p</span><span class=p>.</span><span class=na>hash</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>hash</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>((</span><span class=n>k</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=na>key</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>key</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=p>(</span><span class=n>key</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>key</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>k</span><span class=p>))))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>e</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>p</span><span class=w> </span><span class=k>instanceof</span><span class=w> </span><span class=n>TreeNode</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>e</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>((</span><span class=n>TreeNode</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span><span class=n>V</span><span class=o>&gt;</span><span class=p>)</span><span class=n>p</span><span class=p>).</span><span class=na>putTreeVal</span><span class=p>(</span><span class=k>this</span><span class=p>,</span><span class=w> </span><span class=n>tab</span><span class=p>,</span><span class=w> </span><span class=n>hash</span><span class=p>,</span><span class=w> </span><span class=n>key</span><span class=p>,</span><span class=w> </span><span class=n>value</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>binCount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=o>++</span><span class=n>binCount</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>if</span><span class=w> </span><span class=p>((</span><span class=n>e</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=na>next</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=n>p</span><span class=p>.</span><span class=na>next</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>newNode</span><span class=p>(</span><span class=n>hash</span><span class=p>,</span><span class=w> </span><span class=n>key</span><span class=p>,</span><span class=w> </span><span class=n>value</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>binCount</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=n>TREEIFY_THRESHOLD</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>1</span><span class=p>)</span><span class=w> </span><span class=c1>// -1 for 1st</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>				</span><span class=n>treeifyBin</span><span class=p>(</span><span class=n>tab</span><span class=p>,</span><span class=w> </span><span class=n>hash</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=k>break</span><span class=p>;</span><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=na>hash</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>hash</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=p>((</span><span class=n>k</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>key</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>key</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=p>(</span><span class=n>key</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>key</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>k</span><span class=p>))))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=k>break</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>e</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>e</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=c1>// existing mapping for key</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>V</span><span class=w> </span><span class=n>oldValue</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>value</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>onlyIfAbsent</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>oldValue</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=n>e</span><span class=p>.</span><span class=na>value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>value</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>afterNodeAccess</span><span class=p>(</span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>return</span><span class=w> </span><span class=n>oldValue</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ol><li>é¦–å…ˆåˆ¤æ–­æ•°ç»„ä¸­å…ƒç´ çš„ hash å€¼æ˜¯ä¸æ˜¯å’Œè¦æ’å…¥å…ƒç´ çš„ hash å€¼ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´ï¼Œå†ç”¨ <code>equal</code> æ–¹æ³•åˆ¤æ–­ä¸¤ä¸ªå…ƒç´ æ˜¯ä¸æ˜¯ç›¸åŒï¼Œç›¸åŒçš„è¯å…¶å®ä»€ä¹ˆä¹Ÿä¸ç”¨åšï¼Œåªæ˜¯ <code>e = p</code> ï¼Œåé¢ä¼šå°†æ•°ç»„ä¸­çš„å…ƒç´ æ›¿æ¢ä¸ºè¦æ’å…¥çš„å…ƒç´ </li><li>å¦‚æœä¸Šä¸€ä¸ªæ¡ä»¶ä¸ç¬¦åˆï¼Œæ¥ç€åˆ¤æ–­è¦æ’å…¥ä½ç½®ä¸­å·²å­˜åœ¨çš„èŠ‚ç‚¹æ˜¯ä¸æ˜¯æ ‘å½¢èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯æ ‘å½¢èŠ‚ç‚¹å°±è°ƒç”¨ <code>TreeNode</code> çš„ <code>putTreeVal</code> æ–¹æ³•ï¼Œå¯¹å…ƒç´ è¿›è¡Œæ›¿æ¢æˆ–æ’å…¥ï¼Œè¿™é‡Œä¸é˜è¿° TreeNode çš„å…·ä½“å®ç°ï¼Œåªè¦çŸ¥é“å…¶æ˜¯ä¸€é¢—çº¢é»‘æ ‘å³å¯ï¼Œæ„Ÿå…´è¶£å¯ä»¥è‡ªè¡Œç¿»å¼€æºç å’Œçº¢é»‘æ ‘åŸç†</li><li>æœ€åä¸€ç§æƒ…å†µå°±æ˜¯é“¾è¡¨ï¼Œç”¨ä¸€ä¸ª <code>for</code> å¾ªç¯å¯¹é“¾è¡¨è¿›è¡Œéå†ï¼Œéå†è¿‡ç¨‹ä¸­ä¸æ–­çš„ä½¿ç”¨ hash å€¼ å’Œ <code>equals</code> æ–¹æ³•åˆ¤æ–­æ˜¯å¦å­˜åœ¨å…ƒç´ ä¸€è‡´çš„æƒ…å†µï¼Œå¦‚æœä¸€è‡´å°±ç›´æ¥æ›¿æ¢ï¼Œä¸ä¸€è‡´ä¼šä¸€ç›´éå†åˆ°é“¾è¡¨å°¾éƒ¨ï¼Œç„¶åè¿›è¡Œ<strong>å°¾æ’</strong></li></ol><h5 id=å¤´æ’è¿˜æ˜¯å°¾æ’çš„é—®é¢˜>å¤´æ’è¿˜æ˜¯å°¾æ’çš„é—®é¢˜</h5><p>åœ¨è§£å†³å“ˆå¸Œç¢°æ’çš„è¿‡ç¨‹ä¸­ï¼ŒHashMap ä½¿ç”¨é“¾è¡¨å°¾æ’çš„æ–¹å¼ï¼Œä¸ºä»€ä¹ˆæ˜¯å°¾æ’è€Œä¸æ˜¯å¤´æ’å‘¢ï¼Ÿå› ä¸ºå¤´æ’åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ä¼šäº§ç”Ÿå¾ªç¯é“¾è¡¨çš„é—®é¢˜ï¼ˆå…¶å® HashMap æœ¬æ¥å°±ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¤šçº¿ç¨‹æƒ…å†µä¸‹æœ¬æ¥å°±ä¸åº”è¯¥ç›´æ¥ä½¿ç”¨ HashMapï¼‰ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥è‡ªè¡Œæœç´¢</p><h3 id=åˆ é™¤å…ƒç´ å’ŒæŸ¥æ‰¾å…ƒç´ >åˆ é™¤å…ƒç´ å’ŒæŸ¥æ‰¾å…ƒç´ </h3><h4 id=åˆ é™¤å…ƒç´ >åˆ é™¤å…ƒç´ </h4><p>åˆ é™¤å…ƒç´ çš„æºç å¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=n>V</span><span class=w> </span><span class=nf>remove</span><span class=p>(</span><span class=n>Object</span><span class=w> </span><span class=n>key</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Node</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span><span class=n>V</span><span class=o>&gt;</span><span class=w> </span><span class=n>e</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span><span class=n>e</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>removeNode</span><span class=p>(</span><span class=n>hash</span><span class=p>(</span><span class=n>key</span><span class=p>),</span><span class=w> </span><span class=n>key</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=kc>true</span><span class=p>))</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>?</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kc>null</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>value</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>final</span><span class=w> </span><span class=n>Node</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span><span class=n>V</span><span class=o>&gt;</span><span class=w> </span><span class=nf>removeNode</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>hash</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=n>key</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=n>value</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                           </span><span class=kt>boolean</span><span class=w> </span><span class=n>matchValue</span><span class=p>,</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>movable</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Node</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span><span class=n>V</span><span class=o>&gt;[]</span><span class=w> </span><span class=n>tab</span><span class=p>;</span><span class=w> </span><span class=n>Node</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span><span class=n>V</span><span class=o>&gt;</span><span class=w> </span><span class=n>p</span><span class=p>;</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>n</span><span class=p>,</span><span class=w> </span><span class=n>index</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>((</span><span class=n>tab</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>table</span><span class=p>)</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=p>(</span><span class=n>n</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>tab</span><span class=p>.</span><span class=na>length</span><span class=p>)</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>0</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>(</span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>tab</span><span class=o>[</span><span class=n>index</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>n</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>1</span><span class=p>)</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=n>hash</span><span class=o>]</span><span class=p>)</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Node</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span><span class=n>V</span><span class=o>&gt;</span><span class=w> </span><span class=n>node</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>;</span><span class=w> </span><span class=n>K</span><span class=w> </span><span class=n>k</span><span class=p>;</span><span class=w> </span><span class=n>V</span><span class=w> </span><span class=n>v</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>p</span><span class=p>.</span><span class=na>hash</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>hash</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>((</span><span class=n>k</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=na>key</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>key</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=p>(</span><span class=n>key</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>key</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>k</span><span class=p>))))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>node</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>((</span><span class=n>e</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=na>next</span><span class=p>)</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>p</span><span class=w> </span><span class=k>instanceof</span><span class=w> </span><span class=n>TreeNode</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>node</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>((</span><span class=n>TreeNode</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span><span class=n>V</span><span class=o>&gt;</span><span class=p>)</span><span class=n>p</span><span class=p>).</span><span class=na>getTreeNode</span><span class=p>(</span><span class=n>hash</span><span class=p>,</span><span class=w> </span><span class=n>key</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>do</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=na>hash</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>hash</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>((</span><span class=n>k</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>key</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>key</span><span class=w> </span><span class=o>||</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                         </span><span class=p>(</span><span class=n>key</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>key</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>k</span><span class=p>))))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>node</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>e</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=k>break</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>e</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w> </span><span class=k>while</span><span class=w> </span><span class=p>((</span><span class=n>e</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>next</span><span class=p>)</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>node</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>matchValue</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=p>(</span><span class=n>v</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>node</span><span class=p>.</span><span class=na>value</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>value</span><span class=w> </span><span class=o>||</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                             </span><span class=p>(</span><span class=n>value</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>value</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>v</span><span class=p>))))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>node</span><span class=w> </span><span class=k>instanceof</span><span class=w> </span><span class=n>TreeNode</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>((</span><span class=n>TreeNode</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span><span class=n>V</span><span class=o>&gt;</span><span class=p>)</span><span class=n>node</span><span class=p>).</span><span class=na>removeTreeNode</span><span class=p>(</span><span class=k>this</span><span class=p>,</span><span class=w> </span><span class=n>tab</span><span class=p>,</span><span class=w> </span><span class=n>movable</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>node</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>p</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>tab</span><span class=o>[</span><span class=n>index</span><span class=o>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>node</span><span class=p>.</span><span class=na>next</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>else</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>p</span><span class=p>.</span><span class=na>next</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>node</span><span class=p>.</span><span class=na>next</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=o>++</span><span class=n>modCount</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=o>--</span><span class=n>size</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>afterNodeRemoval</span><span class=p>(</span><span class=n>node</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>node</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>ä»£ç æ•´ä½“ä¸éš¾ç†è§£ï¼Œå°±æ˜¯ä½¿ç”¨ <code>(n - 1) & hash</code> å¾—åˆ°å…ƒç´ æ‰€åœ¨ä½ç½®ï¼Œç„¶åä»¥æ¬¡åˆ¤æ–­</p><ol><li>å¦‚æœæ•°ç»„å¯¹åº”ä½ç½®çš„å…ƒç´  hash å€¼å’Œè¦åˆ é™¤å…ƒç´ çš„ hash å€¼ä¸€è‡´ï¼Œå¹¶ä¸”ä¸¤ä¸ªå…ƒç´ ä½¿ç”¨ <code>equals</code> æ–¹æ³•åˆ¤æ–­ç›¸åŒï¼Œé‚£ä¹ˆç›´æ¥ä½¿ <code>node = p</code> ï¼Œåç»­åˆ¤æ–­åˆ° <code>node = p</code> åï¼Œä¼šç›´æ¥è°ƒç”¨ <code>tab[index] = node.next</code> ï¼Œå³å°†ä¹‹å‰å…ƒç´ çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ”¾å…¥æ•°ç»„ä¸­ï¼ˆä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¸º null ä¹Ÿæ²¡æœ‰å…³ç³»ï¼Œå°±ç›´æ¥å°† null æ”¾å…¥æ•°ç»„å³å¯ï¼‰</li><li>å¦‚æœæ•°ç»„ä¸­å­˜å‚¨çš„èŠ‚ç‚¹æ˜¯ä¸€ä¸ªæ ‘å½¢èŠ‚ç‚¹ï¼Œå°±ä½¿ç”¨ TreeNode çš„ <code>getTreeNode</code> æ–¹æ³•æ‰¾åˆ°å¯¹åº”çš„èŠ‚ç‚¹ï¼Œå¹¶åœ¨åç»­ä½¿ç”¨ <code>removeTreeNode</code> æ–¹æ³•å¯¹èŠ‚ç‚¹è¿›è¡Œåˆ é™¤ï¼Œè¿™é‡Œä¸åšå…·ä½“é˜è¿°</li><li>æœ€åï¼Œå¦‚æœæ˜¯é“¾è¡¨ç»“æ„ï¼Œé‚£ä¹ˆå°±æ˜¯ç”¨ <code>do while</code> å¾ªç¯éå†é“¾è¡¨ï¼Œéå†è¿‡ç¨‹ä¸­ä¸æ–­çš„æ¯”è¾ƒ hash å€¼å¹¶ä½¿ç”¨ <code>equals</code> æ–¹æ³•åˆ¤æ–­æ˜¯å¦ç›¸åŒï¼Œå¹¶åœ¨åç»­ä½¿ç”¨ <code>p.next = node.next</code> å°†å‰ä¸€èŠ‚ç‚¹çš„åé©±æŒ‡é’ˆæŒ‡å‘æ‰¾åˆ°èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä»¥æ­¤æ¥åˆ é™¤ç´¢å¼•èŠ‚ç‚¹</li></ol><h4 id=æŸ¥æ‰¾å…ƒç´ >æŸ¥æ‰¾å…ƒç´ </h4><p>æŸ¥æ‰¾å…ƒç´ çš„è¿‡ç¨‹å…¶å®å’Œåˆ é™¤å…ƒç´ æ˜¯æä¸ºç›¸ä¼¼çš„ï¼Œæ ¸å¿ƒå°±æ˜¯ä½¿ç”¨ <code>(n - 1) & hash</code> å’Œ <code>equals</code> æ–¹æ³•ï¼Œæ‰¾åˆ°å­˜å‚¨ä½ç½®ï¼Œå¹¶å¯¹æ•°æ®ç»“æ„è¿›è¡Œéå†æŸ¥æ‰¾ç„¶åè¿”å›</p><p>HashMap æ˜¯ Java åº”ç”¨ä¸­æœ€å¸¸ç”¨çš„æ•°æ®ç»“æ„ä¹‹ä¸€äº†ï¼Œå‚è€ƒ HashMap çš„æºç ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°å¾ˆå¤šç²¾å·§çš„è®¾è®¡ï¼Œæ¯”å¦‚å®¹é‡è®¾ç½®ä¸º 2 çš„æ•´æ•°æ¬¡æ–¹å¹‚ã€éœ‡è¡å‡½æ•°ã€ä¸è¿ç®—ä»£æ›¿å–æ¨¡è¿ç®—ã€å“ˆå¸Œç¢°æ’ç­‰ç­‰</p><blockquote><p>Cover from <a class=link href=https://unsplash.com/@eberhardgross target=_blank rel=noopener>eberhardgross</a> on <a class=link href=https://unsplash.com/ target=_blank rel=noopener>unsplash</a></p></blockquote></section><footer class=article-footer><section class=article-tags><a href=/tags/collection/>Collection</a>
<a href=/tags/list/>List</a>
<a href=/tags/map/>Map</a>
<a href=/tags/hashmap/>HashMap</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/p/%E5%B9%B3%E6%BB%91%E7%9A%84%E5%8A%A0%E6%9D%83%E8%BD%AE%E8%AF%A2%E7%AE%97%E6%B3%95/><div class=article-image><img src=/p/%E5%B9%B3%E6%BB%91%E7%9A%84%E5%8A%A0%E6%9D%83%E8%BD%AE%E8%AF%A2%E7%AE%97%E6%B3%95/cover.954aaa3c1956681213b2a9a8002bd165_hu3d03a01dcc18bc5be0e67db3d8d209a6_331037_250x150_fill_q75_box_smart1.jpg width=250 height=150 loading=lazy alt="Featured image of post å¹³æ»‘çš„åŠ æƒè½®è¯¢ç®—æ³•" data-hash="md5-lUqqPBlWaBITsqmoACvRZQ=="></div><div class=article-details><h2 class=article-title>å¹³æ»‘çš„åŠ æƒè½®è¯¢ç®—æ³•</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//yameizitd.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2023 yameizitd</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.21.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>